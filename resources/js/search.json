[[{"l":"Lag Metrics for Event Hub","p":["Azure Event Hubs are a great event streaming and messaging system, connecting consumers with producers in a decoupled manner.","In production-grade systems it must be monitored if consumers can keep up with producers or if they are falling behind. In traditional messaging systems like Azure Service Bus or Apache ActiveMQ, this is monitored via queue sizes. In event streaming systems like Apache Kafka or Azure Event Hubs, it's a bit more complex. Here, the term lag describes the difference between what has already been written and what has been read in the scope of a consumer group.","Event Hubs provide no built-in metric for monitoring this lag in the Basic and Standard SKUs.","Lag Metrics bridges this gap and makes lag metrics available in Azure Monitor / Application Insights. Based on these metrics, you can define alerting rules, such as thresholds for when the lag exceeds a critical value."]}],[{"l":"Installation","p":["Lag Metrics for Event Hub is packaged as an Azure Managed Application. It can be installed in various ways:"]},{"l":"Azure Portal","p":["Simply click on the button. It will take you to the creation screen on the Azure Portal.","Deploy to Azure"]},{"l":"Bicep","p":["Installation"]},{"l":"az cli","p":["Installation"]},{"l":"Azure Marketplace","p":["You can install it via the Azure Portal via the following URL: Lag Metrics on Azure Marketplace."]}],[{"l":"Installation via Bicep"},{"l":"Writing the Bicep file(s)","p":["The following snippet installs Lag Metrics via Bicep. You can find a minimal, but complete example in a sample repo on GitHub.","This requires the Event Hub connection string, the storage account connection string, the application insights connection string and the container name that holds checkpoints/offsets. See the following sections on how these might be defined via Bicep and how to extract the connection strings."]},{"l":"Event Hubs"},{"l":"Storage Account"},{"l":"Application Insights"},{"l":"Performing the Deployment","p":["You can start the deployment using:","More information on this can be found here."]}],[{"l":"Installation via az cli","p":["The following snippet installs lag-metrics via az cli.","Note that you have to customize this by specifying your subscription, resource group and the various connection strings."]}],[{"l":"Usage","p":["The following metrics are published to Application Insights"]},{"l":"Lag by Topic, Consumer Group and Partition","p":["The name of the metric is EventHubPartitionLag. The value of the metric is the number of messages that have not yet been processed in the context of a certain event hub, partition and consumer group.","Custom dimensions of this metric are:","EventHubNamespace: Name of the Event Hub Namespace.","EventHub: Name of the Event Hub.","ConsumerGroup: Name of the consumer group.","PartitionId: Numerical identifier of the partition. If you have 4 partitions, values are 0, 1, 2 and 3.","This metric provides maximum flexibility as it includes information about partitions.","The lag for a particular Event Hub and Consumer Group can be extracted using the following Log Analytics / KQL query:"]},{"l":"Lag by Event Hub and Consumer Group","p":["The name of the metric is EventHubLag. The value of the metric is the number of messages that have not yet been processed in the context of a certain event hub and consumer group. The values are already summed up over all partitions of the Event Hub. This level of detail is usually sufficient, as the overall lag across all partitions is most relevant.","Custom dimensions of this metric are:","EventHubNamespace: Name of the Event Hub Namespace.","EventHub: Name of the Event Hub.","ConsumerGroup: Name of the consumer group."]}],[{"l":"Defining Alerts","p":["Lag Metrics, as the name implies, simply publishes metrics. You can use regular Azure Monitor alerts to be notified when an alert exceeds a certain threshold.","Here is an example of defining the alert using Bicep, including an action group:","You can find a complete example including an alert on GitHub."]}],[{"l":"Imprint"},{"l":"Information according to § 5 TMG","p":["huditech UG (haftungsbeschränkt) Kurzer Weg 1 72574 Bad Urach Germany","Handelsregister: HRB 782806 Registergericht: Amtsgericht Stuttgart","Represented by: Stefan Hudelmaier"]},{"l":"Contact","p":["Telephone: +49 7125 969 0741 E-Mail: hello@huditech.com"]},{"l":"VAT-ID","p":["VAT-ID (Umsatzsteuer-Identifikationsnummer) according to § 27 a Umsatzsteuergesetz: DE350771094"]}],[{"l":"Privacy Policy","p":["Last updated January 28th, 2023","This privacy policy describes what personal information huditech UG (haftungsbeschränkt) collects from you when you use our Azure Managed Applications, how we use this information, who we share it with and the rights that you have with regards to your personal information.","Our website and applications are designed for businesses. Consequently, we do not offer services or products to be used by individuals for their personal purposes. Accordingly, we treat all personal information we collect solely in the context of their function as business representatives and not as individual persons/consumers.","If you have any additional questions regarding this policy, please contact us at hello@huditech.com"]},{"l":"Cookies","p":["We do not use cookies or other tracking technologies."]},{"l":"Collected Data","p":["We collect your email address, company and name if you contact us for support."]},{"l":"Usage of Data","p":["We use the data to communicate with you to fulfill your support requests."]},{"l":"Security","p":["We perform reasonable and appropriate measures to protect your personal information against accidental or unlawful loss. However, no method of transmission over the Internet or storage technology is 100% secure."]},{"l":"CCPA Privacy Rights (Do Not Sell My Personal Information)","p":["Under the CCPA, among other rights, California consumers have the right to:","Request that a business that collects a consumer's personal data disclose the categories and specific pieces of personal data that a business has collected about consumers.","Request that a business delete any personal data about the consumer that a business has collected.","Request that a business that sells a consumer's personal data, not sell the consumer's personal data.","If you make a request, we have one month to respond to you. If you would like to exercise any of these rights, please contact us at hello@huditech.com"]},{"l":"GDPR Data Protection Rights","p":["Every user is entitled to the following:","The right to access – You have the right to request copies of your personal data.","The right to rectification – You have the right to request that we correct any information you believe is inaccurate. You also have the right to request that we complete the information you believe is incomplete.","The right to erasure – You have the right to request that we erase your personal data, under certain conditions.","The right to restrict processing – You have the right to request that we restrict the processing of your personal data, under certain conditions.","The right to object to processing – You have the right to object to our processing of your personal data, under certain conditions.","The right to data portability – You have the right to request that we transfer the data that we have collected to another organization, or directly to you, under certain conditions.","If you make a request, we have one month to respond to you. If you would like to exercise any of these rights, please contact us at hello@huditech.com"]},{"l":"Updates to this privacy policy","p":["We regularly review and update this policy from time to time as our services and use of personal data evolves. We will update the date of this document each time it is changed."]}]]